@{
    ViewData["Title"] = "Futuros Financieros";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>


@model List<MtbaRfx>

    @Html.Partial("NavBarMtbrfx")

<br />
<br />

<h3>Futuro Financiero</h3>
<br>
<div id="head">
    @Html.Partial("CompraVentaInstrumentos")
</div>

<br />
<hr/>
<a asp-area="" class="btn btn-info" asp-controller="MtbaRfx" asp-action="HistoricoOperaciones">Estado de mis operaciones</a>
<br />


@*<input type="text" id="myInput" placeholder="Texto a buscar..." style="color:black;">
*@
<hr/>
<div class="tableWrap">
    <div id="TablaPrincipal">

        <br />
        <hr />
        <table class="table table-striped table-dark" id="example">
            <thead class="">
                <tr>
                    <th scope="col">Instrumento</th>
                    <th scope="col">Vol. C</th>
                    <th scope="col">Compra</th>
                    <th scope="col">Venta</th>
                    <th scope="col">Vol. V</th>
                    <th scope="col">Ult</th>
                    <th scope="col">Var</th>
                    <th scope="col">Var%</th>
                    <th scope="col">Vol. Operado</th>
                    <th scope="col">Ajuste</th>
                    <th scope="col">Min</th>
                    <th scope="col">Max</th>
                    <th scope="col">Range</th>
                    <th scope="col">Int. Abierto</th>
                    <th scope="col">Hora</th>
                </tr>
            </thead>
            <tbody>

                @try
                {
                    @foreach (var datos in Model)
                    {
                        <tr>
                            <td>@datos.Instrumento</td>
                            <td>@datos.VolC</td>
                            <td style="background-color:@datos.ColorCompra;">@datos.Compra</td>
                            <td style="background-color:@datos.ColorVenta;">@datos.Venta</td>
                            <td>@datos.VolV</td>
                            <td>@datos.Ult</td>
                            <td>@datos.Var</td>
                            <td>@datos.VarPorcentaje %</td>
                            <td>@Convert.ToDouble(datos.VolOpe).ToString("N0")</td>
                            <td>@datos.Ajuste</td>
                            <td>@datos.Min</td>
                            <td>@datos.Max</td>
                            <td><input type="range" min="@datos.Max" max="@datos.Max" disabled></td>
                            <td>@datos.intAbierto</td>
                            <td>@datos.hora</td>
                        </tr>
                    }
                }
                catch { }


            </tbody>
        </table>

    </div>



</div>

<script>



    (function loop() {
        setTimeout(function () {
            $('#TablaPrincipal').load(location.href + " #TablaPrincipal");
            loop();
        }, 5000);
    })();



     $('#TablaPrincipal').click(function () {

        $('#example tbody').on('click', 'tr', function () {
            /* if ($(this).hasClass('selected')) {
                 // Deseleccionar
                 $(this).removeClass('selected');
                 // Limpiar campos
                 //$('#Clave').val('');
                 //$('#Descripcion').val('');
                 //$('#Obse').val('');
             } else {*/

            // Remover clase de TR seleccionada, si es que hay
            $('tr.selected').removeClass('selected');
            // Asignar clase seleccionada a TR actual
            $(this).addClass('selected');
            // Obtener TD's
            var tds = $(this).children();

            //alert($(tds[0]).text())
            $("#symbol").select2("val", [$(tds[0]).text()]);
            document.getElementById("precio").value = $(tds[2]).text();
            document.getElementById("cantidad").value = $(tds[4]).text();


            // Asignar campos
            /*  $('#Clave').val($(tds[0]).text());
              $('#Descripcion').val($(tds[1]).text());
              $('#Obse').val($(tds[2]).text());*/
            //}
        });

    });

       //setInterval('contador()', 5000);

    var save_lock = false;

    const sleep = (s) =>
        new Promise((p) => setTimeout(p, (s * 1000) | 0))

    async function contador() {
        await sleep(1)


        $('#TablaPrincipal').load(location.href + " #TablaPrincipal");


        $('#example tbody').on('click', 'tr', function () {
            /* if ($(this).hasClass('selected')) {
                 // Deseleccionar
                 $(this).removeClass('selected');
                 // Limpiar campos
                 //$('#Clave').val('');
                 //$('#Descripcion').val('');
                 //$('#Obse').val('');
             } else {*/

            // Remover clase de TR seleccionada, si es que hay
            $('tr.selected').removeClass('selected');
            // Asignar clase seleccionada a TR actual
            $(this).addClass('selected');
            // Obtener TD's
            var tds = $(this).children();

            alert($(tds[0]).text())
            //$("#symbol").select2("val", [$(tds[0]).text()]);


            // Asignar campos
            /*  $('#Clave').val($(tds[0]).text());
              $('#Descripcion').val($(tds[1]).text());
              $('#Obse').val($(tds[2]).text());*/
            //}
        });




        //setTimeout(function () {
        //}, 2000);

        


    }

   // setTimeout('contador()', 10000)


    //$("table[id*='example']").click(function (e) {
    //    e.preventDefault();
    //    //if ($(e.currentTarget).is('tr')) {
    //        alert(1);
    //    //}
    //    e.stopPropagation();
    //    return false;
    //});


        //$('#example tbody').on('click', 'tr', function () {
        //    /* if ($(this).hasClass('selected')) {
        //         // Deseleccionar
        //         $(this).removeClass('selected');
        //         // Limpiar campos
        //         //$('#Clave').val('');
        //         //$('#Descripcion').val('');
        //         //$('#Obse').val('');
        //     } else {*/

        //    // Remover clase de TR seleccionada, si es que hay
        //    $('tr.selected').removeClass('selected');
        //    // Asignar clase seleccionada a TR actual
        //    $(this).addClass('selected');
        //    // Obtener TD's
        //    var tds = $(this).children();

        //    //alert($(tds[0]).text())
        //    $("#symbol").select2("val", [$(tds[0]).text()]);


        //    // Asignar campos
        //    /*  $('#Clave').val($(tds[0]).text());
        //      $('#Descripcion').val($(tds[1]).text());
        //      $('#Obse').val($(tds[2]).text());*/
        //    //}
        //});


   // }

</script>
